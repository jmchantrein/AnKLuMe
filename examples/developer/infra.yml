---
# infra.yml â€” Primary Source of Truth (PSOT)
#
# anklume developer: anklume domain + dev-test domain with nesting
# enabled for Incus-in-Incus testing (Phase 12).
#
# IPs: anklume -> 10.100.0.x (admin), dev-test -> 10.120.0.x (semi-trusted)

project_name: anklume-dev

global:
  addressing:
    base_octet: 10
    zone_base: 100
  default_os_image: "images:debian/13"
  default_connection: community.general.incus
  default_user: root

domains:
  anklume:
    trust_level: admin
    description: "Administration and orchestration"
    machines:
      dev-admin:
        description: "Ansible controller"
        type: lxc
        config:
          security.nesting: "true"
        roles:
          - base_system

  dev-test:
    trust_level: semi-trusted
    description: "Development and testing with Incus-in-Incus"
    ephemeral: true
    machines:
      dev-runner:
        description: "Test runner with nested Incus"
        type: lxc
        config:
          security.nesting: "true"
          security.syscalls.intercept.mknod: "true"
          security.syscalls.intercept.setxattr: "true"
        roles:
          - base_system
      dev-sandbox:
        description: "Sandbox for manual testing"
        type: lxc
        config:
          security.nesting: "true"
        roles:
          - base_system
