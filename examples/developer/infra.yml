---
# infra.yml â€” Primary Source of Truth (PSOT)
#
# Describes your infrastructure at a high level. After editing, run:
#   make sync        # Generate/update Ansible files
#   make apply       # Apply to Incus
#
# See docs/SPEC.md section 5 for the full format reference.

# AnKLuMe developer: anklume domain + dev-test domain with nesting
# enabled for Incus-in-Incus testing (Phase 12).

project_name: anklume-dev

global:
  base_subnet: "10.100"
  default_os_image: "images:debian/13"
  default_connection: community.general.incus
  default_user: root

domains:
  anklume:
    description: "Administration and orchestration"
    subnet_id: 0
    ephemeral: false
    machines:
      dev-admin:
        description: "Ansible controller"
        type: lxc
        ip: "10.100.0.10"
        config:
          security.nesting: "true"
        roles:
          - base_system

  dev-test:
    description: "Development and testing with Incus-in-Incus"
    subnet_id: 1
    ephemeral: true
    machines:
      dev-runner:
        description: "Test runner with nested Incus"
        type: lxc
        ip: "10.100.1.10"
        config:
          security.nesting: "true"
          security.syscalls.intercept.mknod: "true"
          security.syscalls.intercept.setxattr: "true"
        roles:
          - base_system
      dev-sandbox:
        description: "Sandbox for manual testing"
        type: lxc
        ip: "10.100.1.11"
        config:
          security.nesting: "true"
        roles:
          - base_system
