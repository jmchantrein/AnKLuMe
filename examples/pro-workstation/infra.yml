---
# infra.yml — Primary Source of Truth (PSOT)
#
# Professional workstation: 4 domains with strict compartmentalization.
# GPU passthrough on the homelab domain for LLM inference + STT.
#
# IPs: anklume -> 10.100.0.x (admin)
#       perso/pro -> 10.110.x.x (trusted)
#       homelab -> 10.120.0.x (semi-trusted)

project_name: pro-workstation

global:
  addressing:
    base_octet: 10
    zone_base: 100
  default_os_image: "images:debian/13"
  default_connection: community.general.incus
  default_user: root

domains:
  anklume:
    trust_level: admin
    description: "Administration and orchestration"
    machines:
      pw-admin:
        description: "Ansible controller"
        type: lxc
        config:
          security.nesting: "true"
        roles:
          - base_system

  perso:
    trust_level: trusted
    description: "Personal workspace"
    machines:
      pw-perso:
        description: "Personal environment"
        type: lxc
        roles:
          - base_system

  pro:
    trust_level: trusted
    description: "Professional workspace"
    machines:
      pw-dev:
        description: "Development workspace"
        type: lxc
        config:
          limits.cpu: "4"
          limits.memory: "8GiB"
        roles:
          - base_system

  homelab:
    trust_level: semi-trusted
    description: "Homelab with GPU for LLM + STT"
    profiles:
      nvidia-compute:
        devices:
          gpu:
            type: gpu
            gputype: physical
    machines:
      pw-ai:
        description: "AI server — Ollama + Speaches STT (single GPU)"
        type: lxc
        gpu: true
        profiles:
          - default
          - nvidia-compute
        roles:
          - base_system
          - ollama_server
          - stt_server
      pw-webui:
        description: "Open WebUI frontend"
        type: lxc
        roles:
          - base_system
          - open_webui
