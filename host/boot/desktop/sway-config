# anklume sway configuration
# Keybindings: Super (mod4) as primary modifier
# Reference: /opt/anklume/host/boot/desktop/KEYBINDINGS.txt

set $mod Mod4
set $term foot
set $launcher fuzzel

# ── Output ──
output * bg #1a1a2e solid_color

# ── Input ──
input type:keyboard {
    xkb_layout "fr,us"
    xkb_options "grp:alt_shift_toggle"
}

# ── Key bindings ──

# Launch
bindsym $mod+Return exec $term
bindsym $mod+d exec $launcher
bindsym $mod+Shift+q kill
bindsym $mod+Shift+e exec swaynag -t warning -m 'Exit sway?' -B 'Yes' 'swaymsg exit'

# Navigation
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Move windows
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Layout
bindsym $mod+h splith
bindsym $mod+v splitv
bindsym $mod+f fullscreen toggle
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# Workspaces (--to-code: layout-independent, works on AZERTY/QWERTZ)
bindsym --to-code $mod+1 workspace number 1
bindsym --to-code $mod+2 workspace number 2
bindsym --to-code $mod+3 workspace number 3
bindsym --to-code $mod+4 workspace number 4
bindsym --to-code $mod+5 workspace number 5
bindsym --to-code $mod+6 workspace number 6
bindsym --to-code $mod+7 workspace number 7
bindsym --to-code $mod+8 workspace number 8
bindsym --to-code $mod+9 workspace number 9

# Move to workspace
bindsym --to-code $mod+Shift+1 move container to workspace number 1
bindsym --to-code $mod+Shift+2 move container to workspace number 2
bindsym --to-code $mod+Shift+3 move container to workspace number 3
bindsym --to-code $mod+Shift+4 move container to workspace number 4
bindsym --to-code $mod+Shift+5 move container to workspace number 5
bindsym --to-code $mod+Shift+6 move container to workspace number 6
bindsym --to-code $mod+Shift+7 move container to workspace number 7
bindsym --to-code $mod+Shift+8 move container to workspace number 8
bindsym --to-code $mod+Shift+9 move container to workspace number 9

# Resize mode
mode "resize" {
    bindsym Left resize shrink width 10px
    bindsym Down resize grow height 10px
    bindsym Up resize shrink height 10px
    bindsym Right resize grow width 10px
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

# ── Status bar ──
bar {
    position top
    status_command i3status
    colors {
        statusline #e0e0e0
        background #1a1a2e
        inactive_workspace #1a1a2e #1a1a2e #6272a4
        focused_workspace #bd93f9 #bd93f9 #1a1a2e
    }
}

# ── Window decoration ──
default_border pixel 2
gaps inner 4
client.focused #bd93f9 #bd93f9 #1a1a2e #50fa7b
client.unfocused #1a1a2e #1a1a2e #6272a4 #1a1a2e

# ── Window rules ──
# Welcome wizard: floating, centered, focused
for_window [app_id="anklume-welcome"] floating enable, resize set 800 600, move position center
# Keybinding cheat sheet: floating, centered (smaller)
for_window [app_id="anklume-cheatsheet"] floating enable, resize set 600 450, move position center

# ── Startup ──
# Welcome guide on first boot (floating terminal with app_id)
exec_always {
    if [ ! -f ~/.anklume/welcome-done ]; then
        foot --app-id anklume-welcome -e python3 /opt/anklume/scripts/welcome.py --tui &
        foot --app-id anklume-cheatsheet -e bash /opt/anklume/host/boot/desktop/anklume-cheatsheet.sh &
        foot &
    fi
}

# Phase 42 integration (domain-specific config)
include ~/.config/sway/anklume-domains.conf
