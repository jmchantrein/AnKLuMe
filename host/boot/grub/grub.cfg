# GRUB configuration for anklume Live OS (hybrid ISO)
# This is a template — VERITY_HASH_PLACEHOLDER is replaced at build time.

insmod part_gpt
insmod part_msdos
insmod iso9660
insmod fat
insmod search_label
insmod linux
insmod gzio
insmod all_video
insmod keylayouts
insmod at_keyboard

set timeout=5
set default=0

search --no-floppy --label ANKLUME-LIVE --set=root

# Load AZERTY keyboard layout (generated by grub-kbdcomp)
# at_keyboard + console fallback: works on real hardware and serial/QEMU
terminal_input at_keyboard console
keymap /boot/grub/fr.gkb

# Main entries (toram — copies squashfs to RAM for best performance)
menuentry "anklume Live OS (Desktop + GPU)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

menuentry "anklume Live OS (Desktop)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

menuentry "anklume Live OS (Console + GPU)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

menuentry "anklume Live OS (Console)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

# Advanced entries (direct — reads squashfs from media, less RAM needed)
submenu "Advanced (direct boot from media)" {
    menuentry "anklume Live OS (Desktop + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS (Desktop)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS (Console + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS (Console)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }
}
