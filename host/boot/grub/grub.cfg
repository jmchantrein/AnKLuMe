# GRUB configuration for anklume Live OS (hybrid ISO)
# This is a template — placeholders are replaced at build time:
#   VERITY_HASH_PLACEHOLDER → dm-verity root hash
#   BASE_PLACEHOLDER        → distro name (Debian, Arch)
# Desktop environments: KDE Plasma (default), sway, labwc

insmod part_gpt
insmod part_msdos
insmod iso9660
insmod fat
insmod search_label
insmod linux
insmod gzio
insmod all_video
insmod keylayouts
insmod at_keyboard

set timeout=5
set default=0

search --no-floppy --label ANKLUME-LIVE --set=root

# Load AZERTY keyboard layout (generated by grub-kbdcomp)
# at_keyboard + console fallback: works on real hardware and serial/QEMU
terminal_input at_keyboard console
keymap /boot/grub/fr.gkb

# ── Main entries (toram — copies squashfs to RAM for best performance) ──

menuentry "anklume Live OS — BASE_PLACEHOLDER (KDE Plasma + GPU)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=kde anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

menuentry "anklume Live OS — BASE_PLACEHOLDER (KDE Plasma)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=kde anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

menuentry "anklume Live OS — BASE_PLACEHOLDER (Console + GPU)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

menuentry "anklume Live OS — BASE_PLACEHOLDER (Console)" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

# ── More Desktops (sway, labwc) ──
submenu "More Desktops (sway, labwc)" {
    menuentry "anklume Live OS — BASE_PLACEHOLDER (sway Desktop + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=sway anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (sway Desktop)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=sway anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (labwc Desktop + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=labwc anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (labwc Desktop)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=labwc anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }
}

# ── Advanced (direct boot from media, no toram) ──
submenu "Advanced (direct boot from media)" {
    menuentry "anklume Live OS — BASE_PLACEHOLDER (KDE Plasma + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=kde anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (KDE Plasma)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=kde anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (sway Desktop + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=sway anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (sway Desktop)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=sway anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (labwc Desktop + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=labwc anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (labwc Desktop)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=labwc anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (Console + GPU)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live OS — BASE_PLACEHOLDER (Console)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }
}
