# GRUB configuration for anklume Live OS (hybrid ISO)
# This is a template — placeholders are replaced at build time:
#   VERITY_HASH_PLACEHOLDER → dm-verity root hash
#   BASE_PLACEHOLDER        → distro name (Debian, Arch)

insmod part_gpt
insmod part_msdos
insmod iso9660
insmod fat
insmod search_label
insmod linux
insmod gzio
insmod all_video
insmod keylayouts
insmod at_keyboard

set timeout=5
set default=0
set gfxmode=auto
set gfxpayload=keep

search --no-floppy --label ANKLUME-LIVE --set=root

# Load AZERTY keyboard layout (generated by grub-kbdcomp)
# at_keyboard + console fallback: works on real hardware and serial/QEMU
terminal_input at_keyboard console
keymap /boot/grub/fr.gkb

# ── Default entry ──
# KDE Plasma, loads into RAM for performance, NVIDIA auto-detected at boot
menuentry "anklume Live — BASE_PLACEHOLDER" {
    linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=kde anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
    initrd /boot/initrd.img
}

# ── Advanced options ──
submenu "Options avancees / Advanced options" {

    menuentry "anklume Live — BASE_PLACEHOLDER (KDE, no NVIDIA)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=kde anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live — BASE_PLACEHOLDER (sway)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=sway anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live — BASE_PLACEHOLDER (sway, no NVIDIA)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.desktop=sway anklume.verity_hash=VERITY_HASH_PLACEHOLDER modprobe.blacklist=nvidia,nvidia_drm,nvidia_modeset,nvidia_uvm console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live — BASE_PLACEHOLDER (Console)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.toram=1 anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live — BASE_PLACEHOLDER (boot from media, KDE)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.desktop=kde anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }

    menuentry "anklume Live — BASE_PLACEHOLDER (boot from media, Console)" {
        linux /boot/vmlinuz ro boot=anklume anklume.boot_mode=iso anklume.slot=A anklume.verity_hash=VERITY_HASH_PLACEHOLDER console=tty0 console=ttyS0,115200n8
        initrd /boot/initrd.img
    }
}
