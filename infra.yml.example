---
# infra.yml — Primary Source of Truth (PSOT)
#
# Describes your infrastructure at a high level. After editing, run:
#   make sync        # Generate/update Ansible files
#   make apply       # Apply to Incus
#
# See docs/SPEC.md section 5 for the full format reference.

# IMPORTANT: Subnet selection
#
# base_subnet defines the first two octets of all your domain networks.
# Each domain gets: <base_subnet>.<subnet_id>.0/24
# Gateway is always <base_subnet>.<subnet_id>.254
#
# Choose a range that does NOT conflict with your existing LAN:
#   - 10.x.x.x      — large private range (recommended: 10.100)
#   - 172.16-31.x.x  — another private range option
#   - 192.168.x.x    — common home/office LANs (likely conflicts!)
#
# RFC 1918 private address ranges:
#   10.0.0.0/8       (10.0.0.0 – 10.255.255.255)
#   172.16.0.0/12    (172.16.0.0 – 172.31.255.255)
#   192.168.0.0/16   (192.168.0.0 – 192.168.255.255)

project_name: my-infra

global:
  base_subnet: "10.100"
  default_os_image: "images:debian/13"
  # default_connection and default_user are stored in group_vars/all.yml as
  # psot_default_connection / psot_default_user (informational only).
  # They are NOT injected as ansible_connection / ansible_user into domain
  # group_vars because Ansible inventory variables override play-level
  # keywords, which would break infrastructure roles that need
  # connection: local. Connection is controlled at the playbook level.
  default_connection: community.general.incus
  default_user: root

domains:
  admin:
    description: "Administration and orchestration"
    subnet_id: 0
    ephemeral: false  # Protected — cannot be accidentally deleted
    machines:
      admin-ansible:
        description: "Ansible controller — drives the whole infra"
        type: lxc
        ip: "10.100.0.10"
        config:
          security.nesting: "true"
        roles:
          - base_system

  work:
    description: "Professional workspace"
    subnet_id: 1
    ephemeral: false
    machines:
      work-dev:
        description: "Development workspace"
        type: lxc
        ip: "10.100.1.10"
        config:
          limits.cpu: "4"
          limits.memory: "8GiB"
        roles:
          - base_system

  # Example: an ephemeral sandbox domain for testing
  # sandbox:
  #   description: "Disposable test environment"
  #   subnet_id: 10
  #   ephemeral: true  # Can be freely destroyed and recreated
  #   machines:
  #     sandbox-test:
  #       description: "Throwaway test container"
  #       type: lxc
  #       ip: "10.100.10.10"
