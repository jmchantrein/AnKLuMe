---
# Shared task: Wait for dpkg lock to be released
#
# No required variables.
# Usage: ansible.builtin.include_tasks: roles/_shared/tasks/dpkg-wait.yml

- name: Wait for dpkg lock to be released
  ansible.builtin.command:
    argv:
      - fuser
      - /var/lib/dpkg/lock-frontend
  register: _dpkg_lock
  changed_when: false
  failed_when: false
  check_mode: false
  retries: 30
  delay: 5
  until: _dpkg_lock.rc != 0
