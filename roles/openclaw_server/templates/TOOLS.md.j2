{# Jinja2 template — deployed by openclaw_server role (ADR-036) #}
{# Do NOT edit the deployed file directly. Edit THIS template instead. #}
# TOOLS.md - Local Notes

## AnKLuMe Development Server

An MCP/REST server runs in `anklume-instance` ({{ openclaw_server_proxy_ip }}:{{ openclaw_server_proxy_port }}),
giving you full access to the AnKLuMe infrastructure and codebase.

### REST API (simple HTTP calls)

Base URL: `http://{{ openclaw_server_proxy_ip }}:{{ openclaw_server_proxy_port }}`

**List all tools:**
```bash
curl http://{{ openclaw_server_proxy_ip }}:{{ openclaw_server_proxy_port }}/api
```

**Call a tool (GET for no args, POST with JSON for args):**

| Tool | Description | Example |
|------|-------------|---------|
| `git_status` | Show git status | `curl .../api/git_status` |
| `git_log` | Recent commits | `curl -X POST .../api/git_log -d '{"count": 5}'` |
| `git_diff` | Show changes | `curl -X POST .../api/git_diff -d '{"staged": true}'` |
| `make_target` | Run make target | `curl -X POST .../api/make_target -d '{"target": "sync-dry"}'` |
| `run_tests` | Run pytest | `curl -X POST .../api/run_tests -d '{"scope": "generator"}'` |
| `incus_list` | List instances | `curl .../api/incus_list` |
| `incus_exec` | Run in instance | `curl -X POST .../api/incus_exec -d '{"instance": "pw-dev", "command": "hostname"}'` |
| `read_file` | Read repo file | `curl -X POST .../api/read_file -d '{"path": "infra.yml"}'` |
| `claude_code` | Run Claude Code | `curl -X POST .../api/claude_code -d '{"prompt": "Fix lint errors"}'` |
| `lint` | Run linters | `curl .../api/lint` |
| `web_search` | Search the web | `curl -X POST .../api/web_search -d '{"query": "...", "count": 5}'` |
| `web_fetch` | Fetch a URL | `curl -X POST .../api/web_fetch -d '{"url": "https://..."}'` |
| `switch_brain` | Change brain mode | `curl -X POST .../api/switch_brain -d '{"mode": "anklume"}'` |
| `usage` | Token usage stats | `curl .../api/usage` |
| `self_upgrade` | Framework upgrade | `{"action": "check\|upgrade\|apply-openclaw\|update-self"}` |
| `run_full_report` | Full test suite with JSON report | `curl -X POST .../api/run_full_report -d '{"suite": "all"}'` |
| `get_test_progress` | Check running test progress | `curl .../api/get_test_progress` |
| `get_test_report` | Get last test report | `curl .../api/get_test_report` |
| `propose_refactoring` | Local LLM refactoring proposals | `curl -X POST .../api/propose_refactoring -d '{"file_path": "scripts/generate.py", "focus": "simplify"}'` |
| `review_code_local` | Local LLM code review | `curl -X POST .../api/review_code_local -d '{"file_path": "scripts/generate.py", "focus": "quality"}'` |

### Delegation Tools (GPU-accelerated, no API credits)

These tools use the local LLM (qwen2.5-coder:32b / qwen3:30b-a3b) on
the GPU server. They cost zero API credits and are ideal for routine tasks.

**Test delegation workflow:**
1. `run_full_report` — run all test suites (pytest, lint, shellcheck, matrix)
2. `get_test_progress` — monitor progress while tests run
3. `get_test_report` — get structured JSON results with failure details
4. Report findings to the user via Telegram

**Refactoring workflow:**
1. `propose_refactoring("scripts/generate.py", "simplify")` — get argued proposals
2. Report proposals to the user for review
3. User or Claude Code applies approved refactorings

**Code review workflow:**
1. `review_code_local("roles/ollama_server/tasks/main.yml", "conventions")` — quick review
2. Report issues (critical/warning/info) to user
3. Critical issues escalated to Claude Code for fixing

Focus options for `propose_refactoring`: general, simplify, performance, security, readability, dry
Focus options for `review_code_local`: quality, bugs, security, conventions

### MCP Protocol (for MCP-native clients)

SSE endpoint: `http://{{ openclaw_server_proxy_ip }}:{{ openclaw_server_proxy_port }}/sse`
Same tools, accessible via standard MCP protocol.

### Safety

Blocked make targets: `flush`, `nftables-deploy`, `claude-host`
Blocked incus commands: `rm -rf /`, `dd`, `mkfs`, `reboot`, `shutdown`
File reads restricted to the AnKLuMe repository.

### Workflow

To develop and test AnKLuMe:
1. `read_file` to understand current code
2. `git_status` / `git_diff` to see current state
3. `make_target` with `sync-dry` to preview changes
4. `run_tests` to validate
5. `lint` to check code quality
6. `claude_code` for complex tasks (launches Claude Code CLI)

### Infrastructure

| Container | IP | Description |
|-----------|-----|-------------|
| anklume-instance | {{ openclaw_server_proxy_ip }} | Admin + Ansible + MCP server |
| gpu-server | {{ openclaw_server_ollama_ip }} | LLM inference (GPU) |
| openclaw | {{ openclaw_server_openclaw_ip }} | OpenClaw (you) |
